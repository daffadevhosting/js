var ogl=function(t){"use strict";function e(t){let e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function r(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function s(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function n(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function a(t,e){let i=e[0],r=e[1],s=e[2],n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function h(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}let o=function(){let t=[0,0,0],e=[0,0,0];return function(r,s){i(t,r),i(e,s),a(t,t),a(e,e);let n=h(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();class l extends Array{constructor(t=0,e=t,i=t){return super(t,e,i),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}set(t,e=t,i=t){var r,s,n,a;return t.length?this.copy(t):(r=this,s=t,n=e,a=i,r[0]=s,r[1]=n,r[2]=a,this)}copy(t){return i(this,t),this}add(t,e){return e?r(this,t,e):r(this,this,t),this}sub(t,e){return e?s(this,t,e):s(this,this,t),this}multiply(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2]):n(this,this,t),this}divide(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2]):n(this,this,1/t),this}inverse(t=this){var e,i;return i=t,(e=this)[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],this}len(){return e(this)}distance(t){var i,r;let s,n,a;return t?(i=this,s=(r=t)[0]-i[0],n=r[1]-i[1],Math.sqrt(s*s+n*n+(a=r[2]-i[2])*a)):e(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){var e,i,r;let s,n,a,h,o,l;return t?(e=this,s=(i=t)[0]-e[0],n=i[1]-e[1],s*s+n*n+(a=i[2]-e[2])*a):(r=this,h=r[0],o=r[1],h*h+o*o+(l=r[2])*l)}negate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],e[2]=-i[2],this}cross(t,e){var i,r,s;let n,a,h,o,l,u;return i=this,r=t,s=e,n=r[0],a=r[1],h=r[2],o=s[0],l=s[1],u=s[2],i[0]=a*u-h*l,i[1]=h*o-n*u,i[2]=n*l-a*o,this}scale(t){return n(this,this,t),this}normalize(){return a(this,this),this}dot(t){return h(this,t)}equals(t){var e,i;return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}applyMatrix4(t){var e,i,r;let s,n,a,h;return e=this,i=this,r=t,s=i[0],n=i[1],a=i[2],h=(h=r[3]*s+r[7]*n+r[11]*a+r[15])||1,e[0]=(r[0]*s+r[4]*n+r[8]*a+r[12])/h,e[1]=(r[1]*s+r[5]*n+r[9]*a+r[13])/h,e[2]=(r[2]*s+r[6]*n+r[10]*a+r[14])/h,this}applyQuaternion(t){var e,i,r;let s,n,a,h,o,l,u,_,d,g,c,$,p;return e=this,i=this,r=t,s=i[0],n=i[1],a=i[2],h=r[0],u=(o=r[1])*a-(l=r[2])*n,_=l*s-h*a,d=h*n-o*s,g=o*d-l*_,c=l*u-h*d,$=h*_-o*u,u*=p=2*r[3],_*=p,d*=p,g*=2,c*=2,$*=2,e[0]=s+u+g,e[1]=n+_+c,e[2]=a+d+$,this}angle(t){return o(this,t)}lerp(t,e){var i,r,s,n;let a,h,o;return i=this,r=this,s=t,n=e,a=r[0],h=r[1],o=r[2],i[0]=a+n*(s[0]-a),i[1]=h+n*(s[1]-h),i[2]=o+n*(s[2]-o),this}clone(){return new l(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){let e=this[0],i=this[1],r=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*r,this[1]=t[1]*e+t[5]*i+t[9]*r,this[2]=t[2]*e+t[6]*i+t[10]*r,this.normalize()}}let u=new l,_=0,d=0;class g{constructor(t,e={}){for(let i in this.gl=t,this.attributes=e,this.id=_++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,e)this.addAttribute(i,e[i])}addAttribute(t,e){if(this.attributes[t]=e,e.id=d++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced||0,e.needsUpdate=!1,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,e)=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);let i=this.attributes[e];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.id,this.gl.vertexAttribPointer(t,i.size,i.type,i.normalize,0,0),this.gl.enableVertexAttribArray(t),this.gl.renderer.vertexAttribDivisor(t,i.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach((t,e)=>{let i=this.attributes[e];i.needsUpdate&&this.updateAttribute(i)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}computeBoundingBox(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||(this.bounds={min:new l,max:new l,center:new l,scale:new l,radius:1/0});let e=this.bounds.min,i=this.bounds.max,r=this.bounds.center,s=this.bounds.scale;e.set(1/0),i.set(-1/0);for(let n=0,a=t.length;n<a;n+=3){let h=t[n],o=t[n+1],u=t[n+2];e.x=Math.min(h,e.x),e.y=Math.min(o,e.y),e.z=Math.min(u,e.z),i.x=Math.max(h,i.x),i.y=Math.max(o,i.y),i.z=Math.max(u,i.z)}s.sub(i,e),r.add(e,i).divide(2)}computeBoundingSphere(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||this.computeBoundingBox(t);let e=0;for(let i=0,r=t.length;i<r;i+=3)u.fromArray(t,i),e=Math.max(e,this.bounds.center.squaredDistance(u));this.bounds.radius=Math.sqrt(e)}remove(){for(let t in this.vao&&this.gl.renderer.deleteVertexArray(this.vao),this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let c=0,$={};class p{constructor(t,{vertex:e,fragment:i,uniforms:r={},transparent:s=!1,cullFace:n=t.BACK,frontFace:a=t.CCW,depthTest:h=!0,depthWrite:o=!0,depthFunc:l=t.LESS}={}){this.gl=t,this.uniforms=r,this.id=c++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=n,this.frontFace=a,this.depthTest=h,this.depthWrite=o,this.depthFunc=l,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));let u=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,e),t.compileShader(u),""!==t.getShaderInfoLog(u)&&console.warn(`${t.getShaderInfoLog(u)}
Vertex Shader
${f(e)}`);let _=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(_,i),t.compileShader(_),""!==t.getShaderInfoLog(_)&&console.warn(`${t.getShaderInfoLog(_)}
Fragment Shader
${f(i)}`),this.program=t.createProgram(),t.attachShader(this.program,u),t.attachShader(this.program,_),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(u),t.deleteShader(_),this.uniformLocations=new Map;let d=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let g=0;g<d;g++){let $=t.getActiveUniform(this.program,g);this.uniformLocations.set($,t.getUniformLocation(this.program,$.name));let p=$.name.match(/(\w+)/g);$.uniformName=p[0],3===p.length?($.isStructArray=!0,$.structIndex=Number(p[1]),$.structProperty=p[2]):2===p.length&&isNaN(Number(p[1]))&&($.isStruct=!0,$.structProperty=p[1])}this.attributeLocations=new Map;let m=[],x=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let v=0;v<x;v++){let w=t.getActiveAttrib(this.program,v),b=t.getAttribLocation(this.program,w.name);m[b]=w.name,this.attributeLocations.set(w.name,b)}this.attributeOrder=m.join("")}setBlendFunc(t,e,i,r){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,i)=>{let r=i.uniformName,s=this.uniforms[r];if(i.isStruct&&(s=s[i.structProperty],r+=`.${i.structProperty}`),i.isStructArray&&(s=s[i.structIndex][i.structProperty],r+=`[${i.structIndex}].${i.structProperty}`),!s)return v(`Active uniform ${r} has not been supplied`);if(s&&void 0===s.value)return v(`${r} uniform is missing a value parameter`);if(s.value.texture)return e+=1,s.value.update(e),m(this.gl,i.type,t,e);if(s.value.length&&s.value[0].texture){let n=[];return s.value.forEach(t=>{e+=1,t.update(e),n.push(e)}),m(this.gl,i.type,t,n)}m(this.gl,i.type,t,s.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function m(t,e,i,r){r=r.length?function(t){let e=t.length,i=t[0].length;if(void 0===i)return t;let r=e*i,s=$[r];s||($[r]=s=new Float32Array(r));for(let n=0;n<e;n++)s.set(t[n],n*i);return s}(r):r;let s=t.renderer.state.uniformLocations.get(i);if(r.length){if(void 0===s)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}(s,r))return;s.set(r),t.renderer.state.uniformLocations.set(i,s)}}else{if(s===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function f(t){let e=t.split("\n");for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}let x=0;function v(t){x>100||(console.warn(t),++x>100&&console.warn("More than 100 program warnings - stopping logs."))}let w=new l;function b(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function E(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function A(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=i*i+r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=s*a,t[3]=n*a,t}function y(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=i[0],o=i[1],l=i[2],u=i[3];return t[0]=r*u+a*h+s*l-n*o,t[1]=s*u+a*o+n*h-r*l,t[2]=n*u+a*l+r*o-s*h,t[3]=a*u-r*h-s*o-n*l,t}let T=b,F=E,M=A;class R extends Array{constructor(t=0,e=0,i=0,r=1){return super(t,e,i,r),this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}get w(){return this[3]}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,i,r){return t.length?this.copy(t):(F(this,t,e,i,r),this.onChange(),this)}rotateX(t){var e,i,r;let s,n,a,h,o,l;return e=this,i=this,r=t,r*=.5,s=i[0],n=i[1],a=i[2],h=i[3],o=Math.sin(r),l=Math.cos(r),e[0]=s*l+h*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=h*l-s*o,this.onChange(),this}rotateY(t){var e,i,r;let s,n,a,h,o,l;return e=this,i=this,r=t,r*=.5,s=i[0],n=i[1],a=i[2],h=i[3],o=Math.sin(r),l=Math.cos(r),e[0]=s*l-a*o,e[1]=n*l+h*o,e[2]=a*l+s*o,e[3]=h*l-n*o,this.onChange(),this}rotateZ(t){var e,i,r;let s,n,a,h,o,l;return e=this,i=this,r=t,r*=.5,s=i[0],n=i[1],a=i[2],h=i[3],o=Math.sin(r),l=Math.cos(r),e[0]=s*l+n*o,e[1]=n*l-s*o,e[2]=a*l+h*o,e[3]=h*l-a*o,this.onChange(),this}inverse(t=this){var e,i;let r,s,n,a,h,o;return e=this,r=(i=t)[0],s=i[1],o=(h=r*r+s*s+(n=i[2])*n+(a=i[3])*a)?1/h:0,e[0]=-r*o,e[1]=-s*o,e[2]=-n*o,e[3]=a*o,this.onChange(),this}conjugate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=i[3],this.onChange(),this}copy(t){return T(this,t),this.onChange(),this}normalize(t=this){return M(this,t),this.onChange(),this}multiply(t,e){return e?y(this,t,e):y(this,this,t),this.onChange(),this}dot(t){var e,i;return e=this,i=t,e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}fromMatrix3(t){return function(t,e){let i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);let n=(s+1)%3,a=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*a+a]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+a]-e[3*a+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[a]=(e[3*a+s]+e[3*s+a])*i}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,i="YXZ"){let r=Math.sin(.5*e[0]),s=Math.cos(.5*e[0]),n=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),h=Math.sin(.5*e[2]),o=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o-r*n*h):"YXZ"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o+r*n*h):"ZXY"===i?(t[0]=r*a*o-s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o-r*n*h):"ZYX"===i?(t[0]=r*a*o-s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o+r*n*h):"YZX"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o-r*n*h):"XZY"===i&&(t[0]=r*a*o-s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o+r*n*h)}(this,t,t.order),this}fromAxisAngle(t,e){var i,r,s;let n;return i=this,r=t,s=e,n=Math.sin(s*=.5),i[0]=n*r[0],i[1]=n*r[1],i[2]=n*r[2],i[3]=Math.cos(s),this}slerp(t,e){var i,r,s,n;let a,h,o,l,u,_,d,g,c,$,p,m,f;return i=this,r=this,s=t,n=e,_=r[0],d=r[1],g=r[2],c=r[3],$=s[0],p=s[1],(h=_*$+d*p+g*(m=s[2])+c*(f=s[3]))<0&&(h=-h,$=-$,p=-p,m=-m,f=-f),1-h>1e-6?(l=Math.sin((1-n)*a)/(o=Math.sin(a=Math.acos(h))),u=Math.sin(n*a)/o):(l=1-n,u=n),i[0]=l*_+u*$,i[1]=l*d+u*p,i[2]=l*g+u*m,i[3]=l*c+u*f,this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}function S(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],_=e[8],d=e[9],g=e[10],c=e[11],$=e[12],p=e[13],m=e[14],f=e[15],x=i[0],v=i[1],w=i[2],b=i[3];return t[0]=x*r+v*h+w*_+b*$,t[1]=x*s+v*o+w*d+b*p,t[2]=x*n+v*l+w*g+b*m,t[3]=x*a+v*u+w*c+b*f,x=i[4],v=i[5],w=i[6],b=i[7],t[4]=x*r+v*h+w*_+b*$,t[5]=x*s+v*o+w*d+b*p,t[6]=x*n+v*l+w*g+b*m,t[7]=x*a+v*u+w*c+b*f,x=i[8],v=i[9],w=i[10],b=i[11],t[8]=x*r+v*h+w*_+b*$,t[9]=x*s+v*o+w*d+b*p,t[10]=x*n+v*l+w*g+b*m,t[11]=x*a+v*u+w*c+b*f,x=i[12],v=i[13],w=i[14],b=i[15],t[12]=x*r+v*h+w*_+b*$,t[13]=x*s+v*o+w*d+b*p,t[14]=x*n+v*l+w*g+b*m,t[15]=x*a+v*u+w*c+b*f,t}class L extends Array{constructor(t=1,e=0,i=0,r=0,s=0,n=1,a=0,h=0,o=0,l=0,u=1,_=0,d=0,g=0,c=0,$=1){return super(t,e,i,r,s,n,a,h,o,l,u,_,d,g,c,$),this}set x(t){this[12]=t}get x(){return this[12]}set y(t){this[13]=t}get y(){return this[13]}set z(t){this[14]=t}get z(){return this[14]}set w(t){this[15]=t}get w(){return this[15]}set(t,e,i,r,s,n,a,h,o,l,u,_,d,g,c,$){var p,m,f,x,v,w,b,E,A,y,T,F,M,R,S,L,N;return t.length?this.copy(t):(p=this,m=t,f=e,x=i,v=r,w=s,b=n,E=a,A=h,y=o,T=l,F=u,M=_,R=d,S=g,L=c,N=$,p[0]=m,p[1]=f,p[2]=x,p[3]=v,p[4]=w,p[5]=b,p[6]=E,p[7]=A,p[8]=y,p[9]=T,p[10]=F,p[11]=M,p[12]=R,p[13]=S,p[14]=L,p[15]=N,this)}translate(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c,$,p,m,f,x;return i=this,r=e,m=(s=t)[0],f=s[1],x=s[2],r===i?(i[12]=r[0]*m+r[4]*f+r[8]*x+r[12],i[13]=r[1]*m+r[5]*f+r[9]*x+r[13],i[14]=r[2]*m+r[6]*f+r[10]*x+r[14],i[15]=r[3]*m+r[7]*f+r[11]*x+r[15]):(n=r[0],a=r[1],h=r[2],o=r[3],l=r[4],u=r[5],_=r[6],d=r[7],g=r[8],c=r[9],$=r[10],p=r[11],i[0]=n,i[1]=a,i[2]=h,i[3]=o,i[4]=l,i[5]=u,i[6]=_,i[7]=d,i[8]=g,i[9]=c,i[10]=$,i[11]=p,i[12]=n*m+l*f+g*x+r[12],i[13]=a*m+u*f+c*x+r[13],i[14]=h*m+_*f+$*x+r[14],i[15]=o*m+d*f+p*x+r[15]),this}rotateX(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c;return i=this,r=e,n=Math.sin(s=t),a=Math.cos(s),h=r[4],o=r[5],l=r[6],u=r[7],_=r[8],d=r[9],g=r[10],c=r[11],r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=h*a+_*n,i[5]=o*a+d*n,i[6]=l*a+g*n,i[7]=u*a+c*n,i[8]=_*a-h*n,i[9]=d*a-o*n,i[10]=g*a-l*n,i[11]=c*a-u*n,this}rotateY(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c;return i=this,r=e,n=Math.sin(s=t),a=Math.cos(s),h=r[0],o=r[1],l=r[2],u=r[3],_=r[8],d=r[9],g=r[10],c=r[11],r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=h*a-_*n,i[1]=o*a-d*n,i[2]=l*a-g*n,i[3]=u*a-c*n,i[8]=h*n+_*a,i[9]=o*n+d*a,i[10]=l*n+g*a,i[11]=u*n+c*a,this}rotateZ(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c;return i=this,r=e,n=Math.sin(s=t),a=Math.cos(s),h=r[0],o=r[1],l=r[2],u=r[3],_=r[4],d=r[5],g=r[6],c=r[7],r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=h*a+_*n,i[1]=o*a+d*n,i[2]=l*a+g*n,i[3]=u*a+c*n,i[4]=_*a-h*n,i[5]=d*a-o*n,i[6]=g*a-l*n,i[7]=c*a-u*n,this}scale(t,e=this){var i,r,s;let n,a,h;return i=this,r=e,n=(s="number"==typeof t?[t,t,t]:t)[0],a=s[1],h=s[2],i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=r[3]*n,i[4]=r[4]*a,i[5]=r[5]*a,i[6]=r[6]*a,i[7]=r[7]*a,i[8]=r[8]*h,i[9]=r[9]*h,i[10]=r[10]*h,i[11]=r[11]*h,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}multiply(t,e){return e?S(this,t,e):S(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}fromPerspective({fov:t,aspect:e,near:i,far:r}={}){var s,n,a,h,o;let l,u;return s=this,n=t,a=e,h=i,o=r,l=1/Math.tan(n/2),u=1/(h-o),s[0]=l/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(o+h)*u,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*o*h*u,s[15]=0,this}fromOrthogonal({left:t,right:e,bottom:i,top:r,near:s,far:n}){var a,h,o,l,u,_,d;let g,c,$;return a=this,h=t,o=e,l=i,u=r,_=s,d=n,g=1/(h-o),c=1/(l-u),$=1/(_-d),a[0]=-2*g,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*$,a[11]=0,a[12]=(h+o)*g,a[13]=(u+l)*c,a[14]=(d+_)*$,a[15]=1,this}fromQuaternion(t){var e,i;let r,s,n,a,h,o,l,u,_,d,g,c,$,p,m,f;return e=this,r=(i=t)[0],s=i[1],n=i[2],a=i[3],h=r+r,o=s+s,l=n+n,u=r*h,_=s*h,d=s*o,g=n*h,c=n*o,$=n*l,p=a*h,m=a*o,f=a*l,e[0]=1-d-$,e[1]=_+f,e[2]=g-m,e[3]=0,e[4]=_-f,e[5]=1-u-$,e[6]=c+p,e[7]=0,e[8]=g+m,e[9]=c-p,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){var e,i;let r,s,n,a,h,o,l,u,_,d,g,c,$,p,m,f,x,v,w,b,E,A,y,T,F,M,R,S,L;return e=this,r=(i=t)[0],s=i[1],n=i[2],a=i[3],h=i[4],o=i[5],l=i[6],u=i[7],_=i[8],d=i[9],g=i[10],c=i[11],$=i[12],p=i[13],m=i[14],f=i[15],x=r*o-s*h,v=r*l-n*h,w=r*u-a*h,b=s*l-n*o,E=s*u-a*o,A=n*u-a*l,y=_*p-d*$,T=_*m-g*$,F=_*f-c*$,M=d*m-g*p,R=d*f-c*p,(L=x*(S=g*f-c*m)-v*R+w*M+b*F-E*T+A*y)&&(L=1/L,e[0]=(o*S-l*R+u*M)*L,e[1]=(n*R-s*S-a*M)*L,e[2]=(p*A-m*E+f*b)*L,e[3]=(g*E-d*A-c*b)*L,e[4]=(l*F-h*S-u*T)*L,e[5]=(r*S-n*F+a*T)*L,e[6]=(m*w-$*A-f*v)*L,e[7]=(_*A-g*w+c*v)*L,e[8]=(h*R-o*F+u*y)*L,e[9]=(s*F-r*R-a*y)*L,e[10]=($*E-p*w+f*x)*L,e[11]=(d*w-_*E-c*x)*L,e[12]=(o*T-h*M-l*y)*L,e[13]=(r*M-s*T+n*y)*L,e[14]=(p*v-$*b-m*x)*L,e[15]=(_*b-d*v+g*x)*L),this}compose(t,e,i){var r,s,n,a;let h,o,l,u,_,d,g,c,$,p,m,f,x,v,w,b,E,A,y;return r=this,s=t,n=e,a=i,h=s[0],o=s[1],l=s[2],u=s[3],_=h+h,d=o+o,g=l+l,c=h*_,$=h*d,p=h*g,m=o*d,f=o*g,x=l*g,v=u*_,w=u*d,b=u*g,E=a[0],A=a[1],y=a[2],r[0]=(1-(m+x))*E,r[1]=($+b)*E,r[2]=(p-w)*E,r[3]=0,r[4]=($-b)*A,r[5]=(1-(c+x))*A,r[6]=(f+v)*A,r[7]=0,r[8]=(p+w)*y,r[9]=(f-v)*y,r[10]=(1-(c+m))*y,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,this}getRotation(t){var e,i;let r,s;return e=t,i=this,r=i[0]+i[5]+i[10],s=0,r>0?(s=2*Math.sqrt(r+1),e[3]=.25*s,e[0]=(i[6]-i[9])/s,e[1]=(i[8]-i[2])/s,e[2]=(i[1]-i[4])/s):i[0]>i[5]&&i[0]>i[10]?(s=2*Math.sqrt(1+i[0]-i[5]-i[10]),e[3]=(i[6]-i[9])/s,e[0]=.25*s,e[1]=(i[1]+i[4])/s,e[2]=(i[8]+i[2])/s):i[5]>i[10]?(s=2*Math.sqrt(1+i[5]-i[0]-i[10]),e[3]=(i[8]-i[2])/s,e[0]=(i[1]+i[4])/s,e[1]=.25*s,e[2]=(i[6]+i[9])/s):(s=2*Math.sqrt(1+i[10]-i[0]-i[5]),e[3]=(i[1]-i[4])/s,e[0]=(i[8]+i[2])/s,e[1]=(i[6]+i[9])/s,e[2]=.25*s),this}getTranslation(t){var e,i;return i=this,(e=t)[0]=i[12],e[1]=i[13],e[2]=i[14],this}getScaling(t){var e,i;let r,s,n,a,h,o,l,u,_;return e=t,i=this,r=i[0],s=i[1],n=i[2],a=i[4],h=i[5],o=i[6],l=i[8],u=i[9],_=i[10],e[0]=Math.sqrt(r*r+s*s+n*n),e[1]=Math.sqrt(a*a+h*h+o*o),e[2]=Math.sqrt(l*l+u*u+_*_),this}getMaxScaleOnAxis(){var t;let e,i,r,s,n,a,h,o,l;return t=this,e=t[0],i=t[1],r=t[2],s=t[4],n=t[5],a=t[6],h=t[8],o=t[9],Math.sqrt(Math.max(e*e+i*i+r*r,s*s+n*n+a*a,h*h+o*o+(l=t[10])*l))}lookAt(t,e,i){var r,s,n,a;let h,o,l,u,_,d,g,c,$,p,m,f,x;return r=this,s=t,n=e,a=i,h=s[0],o=s[1],l=s[2],u=a[0],_=a[1],d=a[2],g=h-n[0],(p=g*g+(c=o-n[1])*c+($=l-n[2])*$)>0&&(g*=p=1/Math.sqrt(p),c*=p,$*=p),m=_*$-d*c,(p=m*m+(f=d*g-u*$)*f+(x=u*c-_*g)*x)>0&&(m*=p=1/Math.sqrt(p),f*=p,x*=p),r[0]=m,r[1]=f,r[2]=x,r[3]=0,r[4]=c*x-$*f,r[5]=$*m-g*x,r[6]=g*f-c*m,r[7]=0,r[8]=g,r[9]=c,r[10]=$,r[11]=0,r[12]=h,r[13]=o,r[14]=l,r[15]=1,this}determinant(){var t;let e,i,r,s,n,a,h,o,l,u,_,d,g,c,$,p;return t=this,e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],h=t[6],o=t[7],l=t[8],u=t[9],_=t[10],d=t[11],g=t[12],c=t[13],$=t[14],(e*a-i*n)*(_*(p=t[15])-d*$)-(e*h-r*n)*(u*p-d*c)+(e*o-s*n)*(u*$-_*c)+(i*h-r*a)*(l*p-d*g)-(i*o-s*a)*(l*$-_*g)+(r*o-s*h)*(l*c-u*g)}}let N=new L;class P extends Array{constructor(t=0,e=t,i=t,r="YXZ"){return super(t,e,i),this.order=r,this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}set(t,e=t,i=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,i="YXZ"){"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),.99999>Math.abs(e[8])?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),.99999>Math.abs(e[9])?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),.99999>Math.abs(e[6])?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),.99999>Math.abs(e[2])?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),.99999>Math.abs(e[1])?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),.99999>Math.abs(e[4])?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return N.fromQuaternion(t),this.fromRotationMatrix(N,e)}}class O{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new L,this.worldMatrix=new L,this.matrixAutoUpdate=!0,this.position=new l,this.quaternion=new R,this.scale=new l(1),this.rotation=new P,this.up=new l(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}let B=new L,C=new l,D=new l;function z(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],_=e[8],d=i[0],g=i[1],c=i[2],$=i[3],p=i[4],m=i[5],f=i[6],x=i[7],v=i[8];return t[0]=d*r+g*a+c*l,t[1]=d*s+g*h+c*u,t[2]=d*n+g*o+c*_,t[3]=$*r+p*a+m*l,t[4]=$*s+p*h+m*u,t[5]=$*n+p*o+m*_,t[6]=f*r+x*a+v*l,t[7]=f*s+x*h+v*u,t[8]=f*n+x*o+v*_,t}class I extends Array{constructor(t=1,e=0,i=0,r=0,s=1,n=0,a=0,h=0,o=1){return super(t,e,i,r,s,n,a,h,o),this}set(t,e,i,r,s,n,a,h,o){var l,u,_,d,g,c,$,p,m,f;return t.length?this.copy(t):(l=this,u=t,_=e,d=i,g=r,c=s,$=n,p=a,m=h,f=o,l[0]=u,l[1]=_,l[2]=d,l[3]=g,l[4]=c,l[5]=$,l[6]=p,l[7]=m,l[8]=f,this)}translate(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c,$;return i=this,r=e,s=t,n=r[0],a=r[1],h=r[2],o=r[3],l=r[4],u=r[5],_=r[6],d=r[7],g=r[8],c=s[0],$=s[1],i[0]=n,i[1]=a,i[2]=h,i[3]=o,i[4]=l,i[5]=u,i[6]=c*n+$*o+_,i[7]=c*a+$*l+d,i[8]=c*h+$*u+g,this}rotate(t,e=this){var i,r,s;let n,a,h,o,l,u,_,d,g,c,$;return i=this,r=e,s=t,n=r[0],a=r[1],h=r[2],o=r[3],l=r[4],u=r[5],_=r[6],d=r[7],g=r[8],c=Math.sin(s),$=Math.cos(s),i[0]=$*n+c*o,i[1]=$*a+c*l,i[2]=$*h+c*u,i[3]=$*o-c*n,i[4]=$*l-c*a,i[5]=$*u-c*h,i[6]=_,i[7]=d,i[8]=g,this}scale(t,e=this){var i,r,s;let n,a;return i=this,r=e,n=(s=t)[0],a=s[1],i[0]=n*r[0],i[1]=n*r[1],i[2]=n*r[2],i[3]=a*r[3],i[4]=a*r[4],i[5]=a*r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}multiply(t,e){return e?z(this,t,e):z(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}fromMatrix4(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this}fromQuaternion(t){var e,i;let r,s,n,a,h,o,l,u,_,d,g,c,$,p,m,f;return e=this,r=(i=t)[0],s=i[1],n=i[2],a=i[3],h=r+r,o=s+s,l=n+n,u=r*h,_=s*h,d=s*o,g=n*h,c=n*o,$=n*l,p=a*h,m=a*o,f=a*l,e[0]=1-d-$,e[3]=_-f,e[6]=g+m,e[1]=_+f,e[4]=1-u-$,e[7]=c-p,e[2]=g-m,e[5]=c+p,e[8]=1-u-d,this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}inverse(t=this){var e,i;let r,s,n,a,h,o,l,u,_,d,g,c,$;return e=this,r=(i=t)[0],s=i[1],n=i[2],a=i[3],h=i[4],o=i[5],l=i[6],u=i[7],d=(_=i[8])*h-o*u,($=r*d+s*(g=-_*a+o*l)+n*(c=u*a-h*l))&&($=1/$,e[0]=d*$,e[1]=(-_*s+n*u)*$,e[2]=(o*s-n*h)*$,e[3]=g*$,e[4]=(_*r-n*l)*$,e[5]=(-o*r+n*a)*$,e[6]=c*$,e[7]=(-u*r+s*l)*$,e[8]=(h*r-s*a)*$),this}getNormalMatrix(t){var e,i;let r,s,n,a,h,o,l,u,_,d,g,c,$,p,m,f,x,v,w,b,E,A,y,T,F,M,R,S,L;return e=this,r=(i=t)[0],s=i[1],n=i[2],a=i[3],h=i[4],o=i[5],l=i[6],u=i[7],_=i[8],d=i[9],g=i[10],c=i[11],$=i[12],p=i[13],m=i[14],f=i[15],x=r*o-s*h,v=r*l-n*h,w=r*u-a*h,b=s*l-n*o,E=s*u-a*o,A=n*u-a*l,y=_*p-d*$,T=_*m-g*$,F=_*f-c*$,M=d*m-g*p,R=d*f-c*p,(L=x*(S=g*f-c*m)-v*R+w*M+b*F-E*T+A*y)&&(L=1/L,e[0]=(o*S-l*R+u*M)*L,e[1]=(l*F-h*S-u*T)*L,e[2]=(h*R-o*F+u*y)*L,e[3]=(n*R-s*S-a*M)*L,e[4]=(r*S-n*F+a*T)*L,e[5]=(s*F-r*R-a*y)*L,e[6]=(p*A-m*E+f*b)*L,e[7]=(m*w-$*A-f*v)*L,e[8]=($*E-p*w+f*x)*L),this}}let U=0;class G extends O{constructor(t,{geometry:e,program:i,mode:r=t.TRIANGLES,frustumCulled:s=!0,renderOrder:n=0}={}){super(t),this.gl=t,this.id=U++,this.geometry=e,this.program=i,this.mode=r,this.frustumCulled=s,this.renderOrder=n,this.modelViewMatrix=new L,this.normalMatrix=new I,this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}})}draw({camera:t}={}){this.onBeforeRender&&this.onBeforeRender({mesh:this,camera:t}),t&&(this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.position,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&0>this.worldMatrix.determinant();this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.onAfterRender&&this.onAfterRender({mesh:this,camera:t})}}let q=new Uint8Array(4);function Y(t){return 0==(t&t-1)}let V=0;class k{constructor(t,{image:e,target:i=t.TEXTURE_2D,type:r=t.UNSIGNED_BYTE,format:s=t.RGBA,internalFormat:n=s,wrapS:a=t.CLAMP_TO_EDGE,wrapT:h=t.CLAMP_TO_EDGE,generateMipmaps:o=!0,minFilter:l=o?t.NEAREST_MIPMAP_LINEAR:t.LINEAR,magFilter:u=t.LINEAR,premultiplyAlpha:_=!1,unpackAlignment:d=4,flipY:g=!0,level:c=0,width:$,height:p=$}={}){this.gl=t,this.id=V++,this.image=e,this.target=i,this.type=r,this.format=s,this.internalFormat=n,this.minFilter=l,this.magFilter=u,this.wrapS=a,this.wrapT=h,this.generateMipmaps=o,this.premultiplyAlpha=_,this.unpackAlignment=d,this.flipY=g,this.level=c,this.width=$,this.height=p,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){let e=!(this.image===this.store.image&&!this.needsUpdate);(e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e&&(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.gl.renderer.isWebgl2||ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image),this.generateMipmaps&&(this.gl.renderer.isWebgl2||Y(this.image.width)&&Y(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))):this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,q),this.store.image=this.image,this.onUpdate&&this.onUpdate())}}class X{constructor(t,{width:e=t.canvas.width,height:i=t.canvas.height,target:r=t.FRAMEBUFFER,color:s=1,depth:n=!0,stencil:a=!1,depthTexture:h=!1,wrapS:o=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,minFilter:u=t.LINEAR,magFilter:_=u,type:d=t.UNSIGNED_BYTE,format:g=t.RGBA,internalFormat:c=g,unpackAlignment:$,premultiplyAlpha:p}={}){this.gl=t,this.width=e,this.height=i,this.buffer=this.gl.createFramebuffer(),this.target=r,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(let m=0;m<s;m++)this.textures.push(new k(t,{width:e,height:i,wrapS:o,wrapT:l,minFilter:u,magFilter:_,type:d,format:g,internalFormat:c,unpackAlignment:$,premultiplyAlpha:p,flipY:!1,generateMipmaps:!1})),this.textures[m].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+m,this.gl.TEXTURE_2D,this.textures[m].texture,0);this.texture=this.textures[0],h&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new k(t,{width:e,height:i,wrapS:o,wrapT:l,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT24:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT,generateMipmaps:!1}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(n&&!a&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),a&&!n&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),n&&a&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}class W extends Array{constructor(t=0,e=0,i=0){return"string"==typeof t&&([t,e,i]=W.hexToRGB(t)),super(t,e,i),this}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}set(t,e,i){return"string"==typeof t&&([t,e,i]=W.hexToRGB(t)),t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}static hexToRGB(t){4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn(`Unable to convert hex string ${t} to rgb values`),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}}function H(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function j(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Z(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Q(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}class K extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}set(t,e=t){var i,r,s;return t.length?this.copy(t):(i=this,r=t,s=e,i[0]=r,i[1]=s,this)}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}add(t,e){return e?H(this,t,e):H(this,this,t),this}sub(t,e){return e?j(this,t,e):j(this,this,t),this}multiply(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1]):Z(this,this,t),this}divide(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1]):Z(this,this,1/t),this}inverse(t=this){var e,i;return i=t,(e=this)[0]=1/i[0],e[1]=1/i[1],this}len(){return Q(this)}distance(t){var e,i,r,s;return t?(e=this,Math.sqrt((r=(i=t)[0]-e[0])*r+(s=i[1]-e[1])*s)):Q(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){var e,i,r,s,n,a,h;return t?(e=this,(r=(i=t)[0]-e[0])*r+(s=i[1]-e[1])*s):(n=this,a=n[0],a*a+(h=n[1])*h)}negate(t=this){var e,i;return i=t,(e=this)[0]=-i[0],e[1]=-i[1],this}cross(t,e){var i,r;return r=e,(i=t)[0]*r[1]-i[1]*r[0]}scale(t){return Z(this,this,t),this}normalize(){var t,e,i,r,s;return t=this,(s=(i=(e=this)[0])*i+(r=e[1])*r)>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,this}dot(t){var e,i;return i=t,(e=this)[0]*i[0]+e[1]*i[1]}equals(t){var e,i;return i=t,(e=this)[0]===i[0]&&e[1]===i[1]}applyMatrix3(t){var e,i,r,s,n;return e=this,r=t,s=(i=this)[0],n=i[1],e[0]=r[0]*s+r[3]*n+r[6],e[1]=r[1]*s+r[4]*n+r[7],this}applyMatrix4(t){var e,i,r;let s,n;return e=this,i=this,r=t,s=i[0],n=i[1],e[0]=r[0]*s+r[4]*n+r[12],e[1]=r[1]*s+r[5]*n+r[13],this}lerp(t,e){var i,r,s,n,a,h;i=this,r=this,s=t,n=e,a=r[0],h=r[1],i[0]=a+n*(s[0]-a),i[1]=h+n*(s[1]-h)}clone(){return new K(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}class J extends g{constructor(t,{width:e=1,height:i=1,widthSegments:r=1,heightSegments:s=1,attributes:n={}}={}){let a=r,h=s,o=(a+1)*(h+1),l=a*h*6,u=new Float32Array(3*o),_=new Float32Array(3*o),d=new Float32Array(2*o),g=o>65536?new Uint32Array(l):new Uint16Array(l);J.buildPlane(u,_,d,g,e,i,0,a,h),Object.assign(n,{position:{size:3,data:u},normal:{size:3,data:_},uv:{size:2,data:d},index:{data:g}}),super(t,n)}static buildPlane(t,e,i,r,s,n,a,h,o,l=0,u=1,_=2,d=1,g=-1,c=0,$=0){let p=c,m=s/h,f=n/o;for(let x=0;x<=o;x++){let v=x*f-n/2;for(let w=0;w<=h;w++,c++){let b=w*m-s/2;if(t[3*c+l]=b*d,t[3*c+u]=v*g,t[3*c+_]=a/2,e[3*c+l]=0,e[3*c+u]=0,e[3*c+_]=a>=0?1:-1,i[2*c]=w/h,i[2*c+1]=1-x/o,x===o||w===h)continue;let E=p+w+x*(h+1),A=p+w+(x+1)*(h+1),y=p+w+(x+1)*(h+1)+1,T=p+w+x*(h+1)+1;r[6*$]=E,r[6*$+1]=A,r[6*$+2]=T,r[6*$+3]=A,r[6*$+4]=y,r[6*$+5]=T,$++}}}}let tt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},te=new l,ti=new K,tr=new K,ts=new l,tn=new l,ta=new l,th=new L,to=new l,tl=new R,tu=new l,t_=new l,td=new R,tg=new l;class tc{constructor({objects:t,data:e}){this.objects=t,this.data=e,this.elapsed=0,this.weight=1,this.duration=e.frames.length-1}update(t=1,e){let i=e?1:this.weight/t,r=this.elapsed%this.duration,s=Math.floor(r),n=r-s,a=this.data.frames[s],h=this.data.frames[(s+1)%this.duration];this.objects.forEach((t,e)=>{to.fromArray(a.position,3*e),tl.fromArray(a.quaternion,4*e),tu.fromArray(a.scale,3*e),t_.fromArray(h.position,3*e),td.fromArray(h.quaternion,4*e),tg.fromArray(h.scale,3*e),to.lerp(t_,n),tl.slerp(td,n),tu.lerp(tg,n),t.position.lerp(to,i),t.quaternion.slerp(tl,i),t.scale.lerp(tu,i)})}}let t$=new L;return t.Animation=tc,t.Box=class extends g{constructor(t,{width:e=1,height:i=1,depth:r=1,widthSegments:s=1,heightSegments:n=1,depthSegments:a=1,attributes:h={}}={}){let o=s,l=n,u=a,_=(o+1)*(l+1)*2+(o+1)*(u+1)*2+(l+1)*(u+1)*2,d=6*(o*l*2+o*u*2+l*u*2),g=new Float32Array(3*_),c=new Float32Array(3*_),$=new Float32Array(2*_),p=_>65536?new Uint32Array(d):new Uint16Array(d),m=0,f=0;J.buildPlane(g,c,$,p,r,i,e,u,l,2,1,0,-1,-1,m,f),J.buildPlane(g,c,$,p,r,i,-e,u,l,2,1,0,1,-1,m+=(u+1)*(l+1),f+=u*l),J.buildPlane(g,c,$,p,e,r,i,u,l,0,2,1,1,1,m+=(u+1)*(l+1),f+=u*l),J.buildPlane(g,c,$,p,e,r,-i,u,l,0,2,1,1,-1,m+=(o+1)*(u+1),f+=o*u),J.buildPlane(g,c,$,p,e,i,-r,o,l,0,1,2,-1,-1,m+=(o+1)*(u+1),f+=o*u),J.buildPlane(g,c,$,p,e,i,r,o,l,0,1,2,1,-1,m+=(o+1)*(l+1),f+=o*l),Object.assign(h,{position:{size:3,data:g},normal:{size:3,data:c},uv:{size:2,data:$},index:{data:p}}),super(t,h)}},t.Camera=class extends O{constructor(t,{near:e=.1,far:i=100,fov:r=45,aspect:s=1,left:n,right:a,bottom:h,top:o}={}){super(t),this.near=e,this.far=i,this.fov=r,this.aspect=s,this.projectionMatrix=new L,this.viewMatrix=new L,this.projectionViewMatrix=new L,n||a?this.orthographic({left:n,right:a,bottom:h,top:o}):this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:i=this.fov,aspect:r=this.aspect}={}){return this.projectionMatrix.fromPerspective({fov:i*(Math.PI/180),aspect:r,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:i=-1,right:r=1,bottom:s=-1,top:n=1}={}){return this.projectionMatrix.fromOrthogonal({left:i,right:r,bottom:s,top:n,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(B.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new l,new l,new l,new l,new l,new l]);let t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let e=0;e<6;e++){let i=1/this.frustum[e].distance();this.frustum[e].multiply(i),this.frustum[e].constant*=i}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();let e=C;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);let i=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,i)}frustumIntersectsSphere(t,e){let i=D;for(let r=0;r<6;r++){let s=this.frustum[r];if(i.copy(s).dot(t)+s.constant<-e)return!1}return!0}},t.Color=W,t.Cylinder=class extends g{constructor(t,{radius:e=.5,height:i=1,radialSegments:r=16,heightSegments:s=1,attributes:n={}}={}){let a=r,h=s,o=(r+1)*(s+1)+2,u=r*(2+2*s)*3,_=new Float32Array(3*o),d=new Float32Array(3*o),g=new Float32Array(2*o),c=o>65536?new Uint32Array(u):new Uint16Array(u),$,p,m,f=0,x=new l;$=0,p=-.5*i,m=0,_[3*f+0]=$,_[3*f+1]=p,_[3*f+2]=m,x.set($,p,m).normalize(),d[3*f]=x.x,d[3*f+1]=x.y,d[3*f+2]=x.z,g[2*f]=0,g[2*f+1]=1;let v=f;$=0,p=.5*i,m=0,_[3*++f+0]=$,_[3*f+1]=p,_[3*f+2]=m,x.set($,p,m).normalize(),d[3*f]=x.x,d[3*f+1]=x.y,d[3*f+2]=x.z,g[2*f]=0,g[2*f+1]=0;let w=f;f++;for(var b=0;b<a+1;b++){let E=b/a;for(var A=0;A<h+1;A++){let y=A/h;$=Math.cos(E*Math.PI*2)*e,p=(y-.5)*i,m=Math.sin(E*Math.PI*2)*e,_[3*f+0]=$,_[3*f+1]=p,_[3*f+2]=m,x.set($,p,m).normalize(),d[3*f]=x.x,d[3*f+1]=x.y,d[3*f+2]=x.z,g[2*f]=E,g[2*f+1]=1-y,f++}}let T=0,F=h+1;for(b=0;b<a;b++){let M=b+1;for(c[3*T+0]=v,c[3*T+1]=2+b*F,c[3*T+2]=2+M*F,T++,A=0;A<h;A++)c[3*T+0]=2+b*F+(A+0),c[3*T+1]=2+b*F+(A+1),c[3*T+2]=2+M*F+(A+0),c[3*++T+0]=2+M*F+(A+0),c[3*T+1]=2+b*F+(A+1),c[3*T+2]=2+M*F+(A+1),T++;c[3*T+0]=2+M*F+h,c[3*T+1]=2+b*F+h,c[3*T+2]=w,T++}Object.assign(n,{position:{size:3,data:_},normal:{size:3,data:d},uv:{size:2,data:g},index:{data:c}}),super(t,n)}},t.Euler=P,t.Flowmap=class{constructor(t,{size:e=512,falloff:i=.3,alpha:r=1,dissipation:s=.96}={}){let n=this;this.gl=t,this.uniform={value:null},this.mask={read:null,write:null,swap(){let t=n.mask.read;n.mask.read=n.mask.write,n.mask.write=t,n.uniform.value=n.mask.read.texture}},function(){let i=t.renderer.extensions[`OES_texture_${t.renderer.isWebgl2?"":"half_"}float_linear`],r={width:e,height:e,type:t.renderer.isWebgl2?t.HALF_FLOAT:t.renderer.extensions.OES_texture_half_float?t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:t.UNSIGNED_BYTE,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA16F:t.RGBA,minFilter:i?t.LINEAR:t.NEAREST,depth:!1};n.mask.read=new X(t,r),n.mask.write=new X(t,r),n.mask.swap()}(),this.aspect=1,this.mouse=new K,this.velocity=new K,this.mesh=new G(t,{geometry:new g(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),program:new p(t,{vertex:"\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:"\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n\n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n\n      vec2 cursor = vUv - uMouse;\n\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n",uniforms:{tMap:n.uniform,uFalloff:{value:.5*i},uAlpha:{value:r},uDissipation:{value:s},uAspect:{value:1},uMouse:{value:n.mouse},uVelocity:{value:n.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}},t.GPGPU=class{constructor(t,{data:e=new Float32Array(16),geometry:i=new g(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}){this.gl=t;let r=e;this.passes=[],this.geometry=i,this.dataLength=r.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(let s=0;s<this.dataLength;s++){let n=s%this.size/this.size,a=Math.floor(s/this.size)/this.size;this.coords.set([n,a],2*s)}let h=(()=>{if(r.length===this.size*this.size*4)return r;{let t=new Float32Array(this.size*this.size*4);return t.set(r),t}})();this.uniform={value:new k(t,{image:h,target:t.TEXTURE_2D,type:t.FLOAT,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA32F:t.RGBA,wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:t.NEAREST,magFilter:t.NEAREST,width:this.size,flipY:!1})};let o={width:this.size,height:this.size,type:t.renderer.isWebgl2?t.HALF_FLOAT:t.renderer.extensions.OES_texture_half_float?t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:t.UNSIGNED_BYTE,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA16F:t.RGBA,minFilter:t.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new X(t,o),write:new X(t,o),swap:()=>{let t=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=t,this.uniform.value=this.fbo.read.texture}}}addPass({vertex:t="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:e="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",uniforms:i={},textureUniform:r="tMap",enabled:s=!0}={}){i[r]=this.uniform;let n=new p(this.gl,{vertex:t,fragment:e,uniforms:i}),a={mesh:new G(this.gl,{geometry:this.geometry,program:n}),program:n,uniforms:i,enabled:s,textureUniform:r};return this.passes.push(a),a}render(){this.passes.filter(t=>t.enabled).forEach((t,e)=>{this.gl.renderer.render({scene:t.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()})}},t.Geometry=g,t.Mat3=I,t.Mat4=L,t.Mesh=G,t.NormalProgram=function(t){return new p(t,{vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat3 normalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    vNormal = normalize(normalMatrix * normal);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragment:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    gl_FragColor.rgb = normalize(vNormal);\n    gl_FragColor.a = 1.0;\n}\n"})},t.Orbit=function(t,{element:e=document,enabled:i=!0,target:r=new l,ease:s=.25,inertia:n=.85,enableRotate:a=!0,rotateSpeed:h=.1,enableZoom:o=!0,zoomSpeed:u=1,enablePan:_=!0,panSpeed:d=.1,minPolarAngle:g=0,maxPolarAngle:c=Math.PI,minAzimuthAngle:$=-1/0,maxAzimuthAngle:p=1/0,minDistance:m=0,maxDistance:f=1/0}={}){this.enabled=i,this.target=r,s=s||1,n=n||1,this.minDistance=m,this.maxDistance=f;let x={radius:1,phi:0,theta:0},v={radius:1,phi:0,theta:0},w={radius:1,phi:0,theta:0},b=new l,E=new l;E.copy(t.position).sub(this.target),w.radius=v.radius=E.distance(),w.theta=v.theta=Math.atan2(E.x,E.z),w.phi=v.phi=Math.acos(Math.min(Math.max(E.y/v.radius,-1),1)),this.update=()=>{v.radius*=x.radius,v.theta+=x.theta,v.phi+=x.phi,v.theta=Math.max($,Math.min(p,v.theta)),v.phi=Math.max(g,Math.min(c,v.phi)),v.radius=Math.max(this.minDistance,Math.min(this.maxDistance,v.radius)),w.phi+=(v.phi-w.phi)*s,w.theta+=(v.theta-w.theta)*s,w.radius+=(v.radius-w.radius)*s,this.target.add(b);let e=w.radius*Math.sin(Math.max(1e-6,w.phi));E.x=e*Math.sin(w.theta),E.y=w.radius*Math.cos(w.phi),E.z=e*Math.cos(w.theta),t.position.copy(this.target).add(E),t.lookAt(this.target),x.theta*=n,x.phi*=n,b.multiply(n),x.radius=1};let A=new K,y=new K,T=new K,F=tt.NONE;function M(){return Math.pow(.95,u)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};let R=(i,r)=>{var s,n,a,h;let o=e===document?document.body:e;te.copy(t.position).sub(this.target);let l=te.distance();s=2*i*(l*=Math.tan((t.fov||45)/2*Math.PI/180))/o.clientHeight,n=t.matrix,te.set(n[0],n[1],n[2]),te.multiply(-s),b.add(te),a=2*r*l/o.clientHeight,h=t.matrix,te.set(h[4],h[5],h[6]),te.multiply(a),b.add(te)};function S(t){x.radius/=t}let L=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===a)return;A.set(t.clientX,t.clientY),F=tt.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===o)return;T.set(t.clientX,t.clientY),F=tt.DOLLY;break;case this.mouseButtons.PAN:if(!1===_)return;y.set(t.clientX,t.clientY),F=tt.PAN}F!==tt.NONE&&(window.addEventListener("mousemove",N,!1),window.addEventListener("mouseup",P,!1))}},N=t=>{var i,r,s,n,l;if(this.enabled)switch(F){case tt.ROTATE:if(!1===a)return;let u;i=t.clientX,r=t.clientY,ti.set(i,r),tr.sub(ti,A).multiply(h),u=e===document?document.body:e,x.theta-=2*Math.PI*tr.x/u.clientHeight,x.phi-=2*Math.PI*tr.y/u.clientHeight,A.copy(ti);break;case tt.DOLLY:if(!1===o)return;s=t,ti.set(s.clientX,s.clientY),tr.sub(ti,T),tr.y>0?S(M()):tr.y<0&&S(1/M()),T.copy(ti);break;case tt.PAN:if(!1===_)return;n=t.clientX,l=t.clientY,ti.set(n,l),tr.sub(ti,y).multiply(d),R(tr.x,tr.y),y.copy(ti)}},P=()=>{this.enabled&&(document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",P,!1),F=tt.NONE)},O=t=>{this.enabled&&o&&(F===tt.NONE||F===tt.ROTATE)&&(t.stopPropagation(),t.deltaY<0?S(1/M()):t.deltaY>0&&S(M()))},B=()=>{this.enabled&&(F=tt.NONE)},z=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",z,!1),e.removeEventListener("mousedown",L,!1),window.removeEventListener("wheel",O,!1),e.removeEventListener("touchstart",C,!1),e.removeEventListener("touchend",B,!1),e.removeEventListener("touchmove",D,!1),window.removeEventListener("mousemove",N,!1),window.removeEventListener("mouseup",P,!1)},e.addEventListener("contextmenu",z,!1),e.addEventListener("mousedown",L,!1),window.addEventListener("wheel",O,!1),e.addEventListener("touchstart",C,{passive:!1}),e.addEventListener("touchend",B,!1),e.addEventListener("touchmove",D,{passive:!1})},t.Plane=J,t.Post=class{constructor(t,{width:e,height:i,dpr:r,wrapS:s=t.CLAMP_TO_EDGE,wrapT:n=t.CLAMP_TO_EDGE,minFilter:a=t.LINEAR,magFilter:h=t.LINEAR,geometry:o=new g(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}={}){this.gl=t,this.options={wrapS:s,wrapT:n,minFilter:a,magFilter:h},this.passes=[],this.geometry=o;let l=this.fbo={read:null,write:null,swap(){let t=l.read;l.read=l.write,l.write=t}};this.resize({width:e,height:i,dpr:r})}addPass({vertex:t="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:e="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",uniforms:i={},textureUniform:r="tMap",enabled:s=!0}={}){i[r]={value:this.fbo.read.texture};let n=new p(this.gl,{vertex:t,fragment:e,uniforms:i}),a={mesh:new G(this.gl,{geometry:this.geometry,program:n}),program:n,uniforms:i,enabled:s,textureUniform:r};return this.passes.push(a),a}resize({width:t,height:e,dpr:i}={}){i&&(this.dpr=i),t&&(this.width=t,this.height=e||t),i=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*i,e=(this.height||this.gl.renderer.height)*i,this.options.width=t,this.options.height=e,this.fbo.read=new X(this.gl,this.options),this.fbo.write=new X(this.gl,this.options)}render({scene:t,camera:e,target:i=null,update:r=!0,sort:s=!0,frustumCull:n=!0}){let a=this.passes.filter(t=>t.enabled);this.gl.renderer.render({scene:t,camera:e,target:a.length?this.fbo.write:i,update:r,sort:s,frustumCull:n}),this.fbo.swap(),a.forEach((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:t.mesh,target:e===a.length-1?i:this.fbo.write,clear:!1}),this.fbo.swap()})}},t.Program=p,t.Quat=R,t.Raycast=class{constructor(t){this.gl=t,this.origin=new l,this.direction=new l}castMouse(t,e=[0,0]){t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(t){Array.isArray(t)||(t=[t]);let e=th,i=ts,r=tn,s=[];return t.forEach(t=>{t.geometry.bounds||t.geometry.computeBoundingBox(),"sphere"===t.geometry.raycast&&t.geometry.bounds===1/0&&t.geometry.computeBoundingSphere(),e.inverse(t.worldMatrix),i.copy(this.origin).applyMatrix4(e),r.copy(this.direction).transformDirection(e);let n=0;(n="sphere"===t.geometry.raycast?this.intersectSphere(t.geometry.bounds,i,r):this.intersectBox(t.geometry.bounds,i,r))&&(t.hit||(t.hit={localPoint:new l}),t.hit.distance=n,t.hit.localPoint.copy(r).multiply(n).add(i),s.push(t))}),s.sort((t,e)=>t.hit.distance-e.hit.distance),s}intersectSphere(t,e=this.origin,i=this.direction){let r=ta;r.sub(t.center,e);let s=r.dot(i),n=r.dot(r)-s*s,a=t.radius*t.radius;if(n>a)return 0;let h=Math.sqrt(a-n),o=s-h,l=s+h;return o<0&&l<0?0:o<0?l:o}intersectBox(t,e=this.origin,i=this.direction){let r,s,n,a,h,o,l=1/i.x,u=1/i.y,_=1/i.z,d=t.min,g=t.max;return r=((l>=0?d.x:g.x)-e.x)*l,s=((l>=0?g.x:d.x)-e.x)*l,n=((u>=0?d.y:g.y)-e.y)*u,r>(a=((u>=0?g.y:d.y)-e.y)*u)||n>s?0:(n>r&&(r=n),a<s&&(s=a),h=((_>=0?d.z:g.z)-e.z)*_,r>(o=((_>=0?g.z:d.z)-e.z)*_)||h>s?0:(h>r&&(r=h),o<s&&(s=o),s<0?0:r>=0?r:s))}},t.RenderTarget=X,t.Renderer=class{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:r=1,alpha:s=!1,depth:n=!0,stencil:a=!1,antialias:h=!1,premultipliedAlpha:o=!1,preserveDrawingBuffer:l=!1,powerPreference:u="default",autoClear:_=!0,webgl:d=2}={}){let g={alpha:s,depth:n,stencil:a,antialias:h,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:u};this.dpr=r,this.alpha=s,this.color=!0,this.depth=n,this.stencil=a,this.premultipliedAlpha=o,this.autoClear=_,2===d&&(this.gl=t.getContext("webgl2",g)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",g)||t.getContext("experimental-webgl",g)),this.gl.renderer=this,this.setSize(e,i),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES")}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=r,void 0!==i?this.gl.blendFuncSeparate(t,e,i,r):this.gl.blendFunc(t,e))}setBlendEquation(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t][i].bind(this.extensions[t]):this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:i,sort:r}){let s=[];if(e&&i&&e.updateFrustum(),t.traverse(t=>{if(!t.visible)return!0;t.draw&&(i&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||s.push(t))}),r){let n=[],a=[],h=[];s.forEach(t=>{t.program.transparent?t.program.depthTest?a.push(t):h.push(t):n.push(t),t.zDepth=0,0===t.renderOrder&&t.program.depthTest&&e&&(t.worldMatrix.getTranslation(w),w.applyMatrix4(e.projectionViewMatrix),t.zDepth=w.z)}),n.sort(this.sortOpaque),a.sort(this.sortTransparent),h.sort(this.sortUI),s=n.concat(a,h)}return s}render({scene:t,camera:e,target:i=null,update:r=!0,sort:s=!0,frustumCull:n=!0,clear:a}){null===i?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(i),this.setViewport(i.width,i.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||i&&i.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),r&&t.updateMatrixWorld(),e&&null===e.parent&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:n,sort:s}).forEach(t=>{t.draw({camera:e})})}},t.Skin=class extends G{constructor(t,{rig:e,geometry:i,program:r,mode:s=t.TRIANGLES}={}){super(t,{geometry:i,program:r,mode:s}),this.createBones(e),this.createBoneTexture(),this.animations=[],Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}})}createBones(t){if(this.root=new O,this.bones=[],t.bones&&t.bones.length){for(let e=0;e<t.bones.length;e++){let i=new O;i.position.fromArray(t.bindPose.position,3*e),i.quaternion.fromArray(t.bindPose.quaternion,4*e),i.scale.fromArray(t.bindPose.scale,3*e),this.bones.push(i)}t.bones.forEach((t,e)=>{if(this.bones[e].name=t.name,-1===t.parent)return this.bones[e].setParent(this.root);this.bones[e].setParent(this.bones[t.parent])}),this.root.updateMatrixWorld(!0),this.bones.forEach(t=>{t.bindInverse=new L(...t.worldMatrix).inverse()})}}createBoneTexture(){if(!this.bones.length)return;let t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new k(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA16F:this.gl.RGBA,flipY:!1,width:t})}addAnimation(t){let e=new tc({objects:this.bones,data:t});return this.animations.push(e),e}update(){let t=0;this.animations.forEach(e=>t+=e.weight),this.animations.forEach((e,i)=>{e.update(t,0===i)})}draw({camera:t}={}){this.root.updateMatrixWorld(!0),this.bones.forEach((t,e)=>{t$.multiply(t.worldMatrix,t.bindInverse),this.boneMatrices.set(t$,16*e)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0),super.draw({camera:t})}},t.Sphere=class extends g{constructor(t,{radius:e=.5,widthSegments:i=16,heightSegments:r=Math.ceil(.5*i),phiStart:s=0,phiLength:n=2*Math.PI,thetaStart:a=0,thetaLength:h=Math.PI,attributes:o={}}={}){let u=i,_=r,d=s,g=n,c=a,$=h,p=(u+1)*(_+1),m=u*_*6,f=new Float32Array(3*p),x=new Float32Array(3*p),v=new Float32Array(2*p),w=p>65536?new Uint32Array(m):new Uint16Array(m),b=0,E=0,A=0,y=c+$,T=[],F=new l;for(let M=0;M<=_;M++){let R=[],S=M/_;for(let L=0;L<=u;L++,b++){let N=L/u,P=-e*Math.cos(d+N*g)*Math.sin(c+S*$),O=e*Math.cos(c+S*$),B=e*Math.sin(d+N*g)*Math.sin(c+S*$);f[3*b]=P,f[3*b+1]=O,f[3*b+2]=B,F.set(P,O,B).normalize(),x[3*b]=F.x,x[3*b+1]=F.y,x[3*b+2]=F.z,v[2*b]=N,v[2*b+1]=1-S,R.push(E++)}T.push(R)}for(let C=0;C<_;C++)for(let D=0;D<u;D++){let z=T[C][D+1],I=T[C][D],U=T[C+1][D],G=T[C+1][D+1];(0!==C||c>0)&&(w[3*A]=z,w[3*A+1]=I,w[3*A+2]=G,A++),(C!==_-1||y<Math.PI)&&(w[3*A]=I,w[3*A+1]=U,w[3*A+2]=G,A++)}Object.assign(o,{position:{size:3,data:f},normal:{size:3,data:x},uv:{size:2,data:v},index:{data:w}}),super(t,o)}},t.Text=function({font:t,text:e,width:i=1/0,align:r="left",size:s=1,letterSpacing:n=0,lineHeight:a=1.4,wordSpacing:h=0,wordBreak:o=!1}){let l=this,u,_,d,g,c,$=/\n/,p=/\s/;function m(){d=t.common.lineHeight,c=s/(g=t.common.base);let i=e.replace(/[ \n]/g,"").length;_={position:new Float32Array(4*i*3),uv:new Float32Array(4*i*2),id:new Float32Array(4*i),index:new Uint16Array(6*i)};for(let r=0;r<i;r++)_.id[r]=r,_.index.set([4*r,4*r+2,4*r+1,4*r+1,4*r+2,4*r+3],6*r);f()}function f(){let d=[],g=0,m=0,f=0,v=w();function w(){let t={width:0,glyphs:[]};return d.push(t),m=g,f=0,t}let b=0;for(;g<e.length&&b<100;){b++;let E=e[g];if(!v.width&&p.test(E)){m=++g,f=0;continue}if($.test(E)){g++,v=w();continue}let A=u[E];if(v.glyphs.length){let y=v.glyphs[v.glyphs.length-1][0],T=x(A.id,y.id)*c;v.width+=T,f+=T}v.glyphs.push([A,v.width]);let F=0;if(p.test(E)?(m=g,f=0,F+=h*s):F+=n*s,F+=A.xadvance*c,v.width+=F,f+=F,v.width>i){if(o&&v.glyphs.length>1){v.width-=F,v.glyphs.pop(),v=w();continue}if(!o&&f!==v.width){let M=g-m+1;v.glyphs.splice(-M,M),g=m,v.width-=f,v=w();continue}}g++}v.width||d.pop(),function(e){let i=t.common.scaleW,n=t.common.scaleH,h=.07*s,o=0;for(let u=0;u<e.length;u++){let d=e[u];for(let g=0;g<d.glyphs.length;g++){let $=d.glyphs[g][0],m=d.glyphs[g][1];if("center"===r?m-=.5*d.width:"right"===r&&(m-=d.width),p.test($.char))continue;m+=$.xoffset*c,h-=$.yoffset*c;let f=$.width*c,x=$.height*c;_.position.set([m,h-x,0,m,h,0,m+f,h-x,0,m+f,h,0],4*o*3);let v=$.x/i,w=$.width/i,b=1-$.y/n,E=$.height/n;_.uv.set([v,b-E,v,b,v+w,b-E,v+w,b],4*o*2),h+=$.yoffset*c,o++}h-=s*a}l.buffers=_,l.numLines=e.length,l.height=l.numLines*s*a}(d)}function x(e,i){for(let r=0;r<t.kernings.length;r++){let s=t.kernings[r];if(!(s.first<e||s.second<i))return s.first>e?0:s.first===e&&s.second>i?0:s.amount}return 0}u={},t.chars.forEach(t=>u[t.char]=t),m(),this.resize=function(t){({width:i}=t),f()},this.update=function(t){({text:e}=t),m()}},t.Texture=k,t.Transform=O,t.Vec2=K,t.Vec3=l,t.Vec4=class extends Array{constructor(t=0,e=t,i=t,r=t){return super(t,e,i,r),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}set(t,e,i,r){return t.length?this.copy(t):(E(this,t,e,i,r),this)}copy(t){return b(this,t),this}normalize(){return A(this,this),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}},t}({});
